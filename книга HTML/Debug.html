<body>
<link rel="stylesheet" type="text/css"href="style.css">
<h1 align=center> Debug </h1><br>
<br>
<time>
&nbsp;&nbsp;&nbsp;&nbsp;Как уже говорилось (см. <a href="vvedeny.html">ВВEДЕНИЕ</a>), программа Debug входит в состав Windows. Запустить программу Debug можно из командной строки или непосредственно из папки, в которой она находится. Чтобы запустить программу из командной строки, выберите команду из меню ПУСК – ВЫПОЛНИТЬ или нажмите комбинацию клавиш WIN + R. В открывшемся окне (рис. 1.5) напечатайте слово debug и нажмите клавишу ENTER или щёлкните кнопку ОК.<br>
<br>
<img src="фото для книги\1.5.png" alt="изображение не найденo"><br>
<pic> Рис. 1.5.Запуск программы Debug</pic><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;После этого откроется окно с пустым экраном и чёрточкой в левом верхнем углу, которая приглашает вас ввести какую-либо команду. Например, чтобы выйти из программы Debug, напечатайте букву q и нажмите ENTER.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Написать программу, используя Debug, можно не единственным способом, но мы пока рассмотрим тот, который больше похож на написание программы для <a href="Emu8086.html">Emu8086</a>.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Чтобы написать уже известную нам программу, используя Debug, сделаем следующее (подразумевается, что Debug вы уже запустили, и увидели черный экран с маленькой мигающей черточкой в левом верхнем углу).<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Введем букву «а» (напоминаю в последний раз - все команды вводятся на английском языке) и нажмем ENTER.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Затем введем программу, нажимая ENTER в конце каждой строки:<br>
<br>
<i>
0B72: 0100 MOV AH, 02<br>
0B72: 0102 MOV DL, 41<br>
0B72: 0104 INT 21<br>
0B72: 0106 INT 20<br>
0B72: 0108<br>
</i>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Результат будет примерно таким, как показано на рис. 1.6.<br>
<br>
<img src="фото для книги\1.6.png" alt="изображение не найденo"><br>
<pic> Рис. 1.6.Создание программы в Debug</pic><br>
<br>
<prim>ПРИМЕЧАНИЕ 1<br></prim>
&nbsp;&nbsp;&nbsp;&nbsp;Обратите внимание, что все числовые значения пишутся без буковки h в конце. Это потому, что Debug работает только с шестнадцатеричными числами, и ему не надо объяснять, в какой системе исчисления вводятся данные.<br>
<prim>ПРИМЕЧАНИЕ 2</prim><br>
&nbsp;&nbsp;&nbsp;&nbsp;После ввода команды -а, появляются символы: 0B72: 0100. В вашем случае первые четыре символа могут быть другими, но нас они пока не интересуют. А как вы думаете, что означает число 0100? Помните директиву ORG 100h (см. раздел <a href="Emu8086.html">Emu8086</a>)? Вот-вот – это адрес, с которого начинается выполнение программы. То есть в память с этим адресом заносится первая команда программы (для файлов СОМ). Каждая команда занимает 2 байта, поэтому следующий адрес будет 0102 и т.д.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Сами команды мы уже знаем (см. раздел <a href="Emu8086.html">Emu8086</a>), поэтому описывать их здесь не будем.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Программа написана – нужно проверить ее работу. Нажмём ENTER ещё раз, чтобы на экране появилась чёрточка, которая говорит о том, что можно вводить команду для Debug. Затем введем команду g (от английского «GO») и нажмем клавишу ENTER. На экране увидим следующее:<br>
<br>
<i>
-g<br>
A<br>
Программа завершилась нормально<br>
-<br>
</i>
&nbsp;&nbsp;&nbsp;&nbsp;Здесь A – та самая буква, которая выводится на экран в результате работы программы. Затем идёт сообщение о нормальном завершении программы (оно может отличаться в зависимости от версии Debug).<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;А теперь, если интересно, можно проверить программу в пошаговом режиме, то есть понаблюдать, как выполняются команды одна за другой. Для этого придется по новой набрать текст программы (не забудьте сначала ввести команду а), затем:<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Введем команду t и нажмем клавишу ENTER. Увидим нечто вроде этого:<br>
<br>
<i>
AX=0200  BX=0000  CX=0000  DX=0000  SP=FFEE  BP=0000  SI=0000  DI=0000<br>
DS=0B72  ES=0B72  SS=0B72  CS=0B72  IP=0102  NV UP EI PL NZ NA PO NC<br>
0B72:0102 B241		MOV	DL,41<br>
</i>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Это есть ни что иное, как состояние регистров процессора после выполнения первой строки программы. Как вы можете видеть, в регистр АН записалось число 02. В нижней строке находится адрес команды и сама команда, которая будет выполняться следующей.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Снова введем команду t и нажмем клавишу ENTER. Увидим следующее:<br>
<br>
<i>
AX=0200  BX=0000  CX=0000  DX=0041  SP=FFEE  BP=0000  SI=0000  DI=0000<br>
DS=0B72  ES=0B72  SS=0B72  CS=0B72  IP=0104  NV UP EI PL NZ NA PO NC<br>
0B72:0104 CD21		INT	21<br>
</i>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Команда MOV DL, 41, как ей и полагается, записала в регистр DL число 41.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Снова введем команду t и нажмем клавишу ENTER. Увидим следующее:<br>
<br>
<i>
AX=0200  BX=0000  CX=0000  DX=0041  SP=FFE8  BP=0000  SI=0000  DI=0000<br>
DS=0B72  ES=0B72  SS=0B72  CS=0347  IP=0225  NV UP EI PL NZ NA PO NC<br>
0347:0225 80FC4B	CMP	AH,4B<br>
</i>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Команды CMP AH,4B нет в нашей программе. Наша программа завершила свою работу. Мы можем долго еще вводить команду t – нам будут выдаваться состояния регистров. Почему это происходит, нам пока не интересно. Лучше введем команду g и нажмем клавишу ENTER, таким образом окончательно выполним нашу программу, и увидим то, что мы уже видели.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Программа написана и проверена. Чтобы создать исполняемый файл, нужно ответить на несколько вопросов:<br>
<br>
<ul>
	<li>Какого размера будет наш файл? Выполнение программы начинается с адреса 0100h, а последняя строка в программе содержит адрес 0108h. Это значит, что размер файла будет 8 байт (108h – 100h = 8).</li>
	<li>Как мы назовем наш файл? А хоть как. Однако, рекомендуется давать файлам английские имена, в которых содержится не более 8 символов (DOSу так приятнее работать). Назовем, например, debug_1.com</li>
</ul>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;А теперь выполним следующие действия:<br>
<br>
<ul>
	<li>Снова напишем нашу программу (тренируйтесь, тренируйтесь...).</li>
	<li>Запишем в регистр СХ размер файла. Для этого введем команду r cx и нажмем ENTER. Затем введем размер файла (8 байт) и нажмем ENTER.</li>
	<li>Введем команду n, затем один пробел и имя файла. Нажмем ENTER.</li>
	<li>И, наконец, введем команду w и нажмем ENTER.</li>
</ul>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;В результате всех этих действий на экране появится следующая информация (см. также рис. 1.7):<br>
<br>
<i>
-r cx<br>
СХ 0000<br>
:8<br>
-n debug_1.com<br>
-w<br>
Запись: 00008 байт<br>
-<br>
</i>
<br>
<img src="фото для книги\1.7.png" alt="изображение не найденo"><br>
<pic> Рис. 1.7.Создание COM-файла с помощью Debug</pic><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Если вы работаете в режиме эмуляции DOS из под WINDOWS, то файл debug_1.com сохранится на рабочий стол, либо в папку текущего пользователя. Это зависит от версии и/или настроек WINDOWS. Теперь его можно запустить как обычную программу. Если в указанных папках вы не нашли этот файл, то найдите его через поиск файлов.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Чувствую, что мы уже устали. Выход из Debug осуществляется командой q.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Набравшись сил и терпения, изучим еще одну опцию Debug – дизассемблер. С его помощью можно дизассемблировать какой-нибудь СОМ-файл (то есть выполнить действие, обратное ассемблированию – преобразовать исполняемый файл в исходный код на языке ассемблера). Допустим, у вас есть программка, написанная не вами – ее исходный код вы не знаете, а посмотреть очень хочется. Для этого и существует дизассемблер.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Итак, программа Debug у нас закрыта. Набираем в командной строке:<br>
<br>
debug debug_1.com<br>
<br>
(где debug_1.com – это имя файла, который мы хотим дизассемблировать) и нажимаем ENTER.<br>
<br>
<prim>ПРИМЕЧАНИЕ</prim><br>
&nbsp;&nbsp;&nbsp;&nbsp;Если программа не запустилась, значит нужно указать полный путь к ней, например<br>
<br>
C:\WINDOWS\COMMAND\debug debug_1.com<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Если же программа запустилась, но выдала ошибку (например: Ошибка 1282 или «Файл не найден»), то нужно указать полный путь к файлу, например:<br>
<br>
C:\WINDOWS\COMMAND\debug C:\MYPROG\debug_1.com<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Если и это не помогло, то, возможно, вы всё-таки где-то допустили ошибку в пути или путь не соответствует требованиям DOS. В таком случае лучше поместить программу в корень диска С, откуда она гарантированно загрузится по пути «C:\debug_1.com».<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Если Debug запустилась без сообщений об ошибках, то вводим команду u и нажимаем ENTER. Вот что мы увидим (примерно, см. также рис 1.8):<br>
<br>
<i>
-u<br>
0BC6:0100 B402		MOV	AH, 02<br>
0BC6:0102 B241		MOV	DL, 41<br>
0BC6:0104 CD21		INT	21<br>
0BC6:0106 CD20		INT	20<br>
0BC6:0108 56		PUSH	SI<br>
0BC6:0109 2E		CS:<br>
0BC6:010A 8A04		MOV	AL, [SI]<br>
0BC6:010C 0AC0		OR	AL, AL<br>
0BC6:010E 741A		JZ	012A<br>
0BC6:0110 3C3A		CMP	AL, 3A<br>
0BC6:0112 750D		JNZ	0121<br>
0BC6:0114 2E		CS:	<br>
0BC6:0115 807C0100	CMP	BYTE PTR [SI+01], 00<br>
0BC6:0119 7506		JNZ	0121<br>
0BC6:011B 2E		CS:<br>
0BC6:011C C60400	MOV 	BYTE PTR [SI], 00<br>
0BC6:011F EB09		JMP 	012A<br>
-<br>
</i>
<br>
<img src="фото для книги\1.8.png" alt="изображение не найденo"><br>
<pic> Рис. 1.8.Дизассемблер Debug</pic><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Посмотрите на первые четыре строки. Узнаете? Это наша программа. Остальные строки нас не интересуют (это инструкции, оставшиеся от программ или данных, отработавших до запуска Debug). Ну а если мы рассматриваем незнакомый файл, как узнать, где кончается программа и начинается «мусор»? Ориентировочно это можно сделать по размеру файла (для очень маленьких программ). Размер можно посмотреть в свойствах файла. Только следует учитывать, что в свойствах файла размер дан в десятичной форме, а Debug нам выдает шестнадцатеричные адреса. Поэтому придется перевести десятичное число в шестнадцатеричное.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Есть еще вариант (который тоже не всегда приемлем) – найти в полученном списке строку, содержащую команду выхода из программы (INT 20).<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Если программа большая, то список ее команд не поместится на экран. Тогда снова вводим команду u и нажимаем ENTER. И так до конца программы.<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;Возможно, вы не увидите на экране свою программу. Это может быть либо из-за того, что программа почему-то не загрузилась, либо по причине несоответствия адресов. Будьте внимательны: обращайте внимание на адреса памяти, которые указаны в левой колонке. Наша программа начинается с адреса 0100. Если адрес другой, то это, соответственно, не наша программа.<br>
<br>
<button onclick="javascript:window.location='Emu8086.html'"; type="button" name "button1" style="wight:80px;height:50px">
	<img src="фото для книги\back.jpg" alt="назад" width="40" height="40">
</button>

<button onclick="javascript:window.location='debug.html'"; type="button" name "button1" style="wight:80px;height:50px">
	<img src="фото для книги\up.jpg" alt="вверх" width="40" height="40">
</button>

<button onclick="javascript:window.location='MASM TASM and WASM.html'"; type="button" name "button2" style="wight:80px;height:50px; float: right;">
	<img src="фото для книги\next.jpg" alt="вперед" width="40" height="40"> 
</button><br><br> 
</time>
</body>